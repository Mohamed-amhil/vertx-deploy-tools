VERTX_VERSION=vert.x-2.0.2-final
VERTX_URL=http://dl.bintray.com/vertx/downloads/$VERTX_VERSION.tar.gz
VERTX_USER=vertx

CREATE_USER=false

chmod +x /etc/init.d/vertx

# Download and unpack vert.x
wget -P /tmp $VERTX_URL
tar -C /opt -xzvf /tmp/$VERTX_VERSION.tar.gz
ln -s /opt/$VERTX_VERSION /opt/vert.x

# Add User
getent passwd $VERTX_USER >/dev/null 2>&1 && CREATE_USER=true

if $CREATE_USER; then
    echo "$VERTX_USER already exists."
else
  groupadd  -f vertx
  useradd -g $VERTX_USER -d /opt/vert.x -s /bin/false $VERTX_USER
fi

# Create LOG dir
if [ ! -d /var/log/vertx ]
then
    mkdir /var/log/vertx
fi

# Create default dirs
mkdir /opt/vert.x/repo
mkdir /opt/vert.x/sys-mods
mkdir /opt/vert.x/mods

# Copy extra libs
cp $bundledjardir/*.jar /opt/vert.x/lib

unzip -d /opt/vert.x/sys-mods/vertx-deploy-mod-1.0.0-SNAPSHOT /$datadir/vertx-deploy-mod-1.0.0-SNAPSHOT.zip
cp /$datadir/logback.xml /opt/vert.x/conf/

# Set user rights
chown -R $VERTX_USER:$VERTX_USER /opt/vert.x/
chown -R $VERTX_USER:$VERTX_USER /var/log/vertx