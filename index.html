<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Vertx-deploy-tools by msoute</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Vertx-deploy-tools</h1>
          <h2>vertx-deploy-tools</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/msoute/vertx-deploy-tools/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/msoute/vertx-deploy-tools/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/msoute/vertx-deploy-tools" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="vertx-deploy-mod" class="anchor" href="#vertx-deploy-mod" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>vertx-deploy-mod</h1>

<h1>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h1>

<p>vertx-deploy-mod</p>

<p>Tooling to deploy Vert.X modules, generic artifacts and (application) configuration onto cloud based instances (Ec2).</p>

<h1>
<a id="installation--configuration" class="anchor" href="#installation--configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation / Configuration</h1>

<h2>
<a id="deploy-artifacts" class="anchor" href="#deploy-artifacts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deploy artifacts.</h2>

<p>The plugin uses the projects pom to determine what artifacts need to be deployed. There are three types of artifacts (in the order of deployment)</p>

<ul>
<li>config : configuration files, unpacked to a specified location</li>
<li>static artifacts : static content, sites etc that are extracted to a specified location on the target host</li>
<li>modules : Vert.x (2) packaged modules</li>
</ul>

<p>To instruct the plugin to deploy an artifact (module, artifact or config) it only needs to be added as a dependency to the pom.xml. The plugin ignores all dependencies specified in parent poms or transitive.</p>

<h3>
<a id="vertx-mod-artifact" class="anchor" href="#vertx-mod-artifact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Vert.x Mod artifact</h3>

<pre><code>...
&lt;dependency&gt;
    &lt;groupId&gt;[groupId]&lt;/groupId&gt;
    &lt;artifactId&gt;[artifactId]&lt;/artifactId&gt;
    &lt;version&gt;[version]&lt;/version&gt;
    &lt;classifier&gt;mod&lt;/classifier&gt;
    &lt;type&gt;zip&lt;/type&gt;
&lt;/dependency&gt;
...
</code></pre>

<p>All modules will be installed as a module and started (either through init.d or internal see vertx module configuration)
identified by classifier mod</p>

<h3>
<a id="config-artifact" class="anchor" href="#config-artifact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Config artifact</h3>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;[groupId]&lt;/groupId&gt;
    &lt;artifactId&gt;[artifactId]&lt;/artifactId&gt;
    &lt;version&gt;[version]&lt;/version&gt;
    &lt;classifier&gt;[classifier]&lt;/version&gt;
    &lt;type&gt;config&lt;/type&gt;
&lt;/dependency&gt;
</code></pre>

<p>These artifacts will be unpacked to the location specified in artifact_context.xml (See appendix creating an artifact). Always before static artifacts or modules
identified by type config</p>

<h3>
<a id="static-artifact" class="anchor" href="#static-artifact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Static artifact</h3>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;[groupId]&lt;/groupId&gt;
    &lt;artifactId&gt;[artifactId]&lt;/artifactId&gt;
    &lt;version&gt;[version]&lt;/version&gt;
    &lt;classifier&gt;site&lt;/version&gt;
    &lt;type&gt;zip&lt;/type&gt;
&lt;/dependency&gt;
</code></pre>

<p>These artifacts will be unpacked to the location specified in artifact_context.xml (See appendix creating an artifact). Always after config artifacts and before modules
identified by classifier site</p>

<h2>
<a id="maven-plugin-configuration" class="anchor" href="#maven-plugin-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Maven Plugin Configuration</h2>

<pre><code>...
&lt;plugin&gt;
    &lt;groupId&gt;nl.jpoint.vertx-deploy-tools&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-deploy-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.2.0-SNAPSHOT&lt;/version&gt;
    &lt;configuration&gt;
        &lt;region&gt;eu-west-1&lt;/region&gt;
        &lt;credentialsId&gt;credentials&lt;/credentialsId&gt;
        &lt;port&gt;6789&lt;/port&gt;
        &lt;deployConfigurations&gt;
            ...
        &lt;/deployConfigurations&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
...
</code></pre>

<h3>
<a id="aws-credendials" class="anchor" href="#aws-credendials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AWS Credendials</h3>

<p>Aws credentials (accessKey / secretKey) should be stored in settings(-security).xml as a server element.</p>

<pre><code>&lt;server&gt;
    &lt;id&gt;credentialsId&lt;/id&gt;
    &lt;username&gt;[accessKey]&lt;/username&gt;
    &lt;password&gt;[secretKey]&lt;/password&gt;    
&lt;/server&gt;
</code></pre>

<h3>
<a id="deployconfigurations" class="anchor" href="#deployconfigurations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DeployConfigurations</h3>

<p>Multiple targets can be configured. The target configuration can be selected with <em>-Ddeploy.target=</em></p>

<h4>
<a id="default-deploy-configuration-options" class="anchor" href="#default-deploy-configuration-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Default Deploy Configuration Options</h4>

<ul>
<li>
<strong>target</strong> : The target id</li>
<li>
<strong>hosts</strong> : List of hosts to deploy to. This property is ignored when deploying when either  <em>useOpsWorks</em> or <em>useAutoScaling</em> is true</li>
<li>
<strong>deployConfig</strong> : Indicates if config artifacts should also be deployed (default : <em>true</em>)</li>
<li>
<strong>exclusions</strong> : List of artifacts that should be ignored </li>
<li>
<strong>testScope</strong> : Include artifacts in test scope (default : <em>false</em>) </li>
<li>
<strong>restart</strong> : Restart whole container or only deployed modules (default : <em>false</em>)<br>
</li>
<li>
<strong>deploySnapshots</strong> : Also deploy -SNAPSHOT artifacts (default : <em>false</em>)<br>
</li>
</ul>

<h4>
<a id="aws-configuration-options" class="anchor" href="#aws-configuration-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Aws Configuration Options</h4>

<ul>
<li>
<strong>awsPrivateIp</strong> : Use public or private ip's to connect to deploy mod. (default : <em>false</em>)<br>
</li>
<li>
<strong>UseOpsWorks</strong> : Use OpsWorks (Layers) to detect instances to deploy to. Cannot be use icw <em>useAutoScaling</em>. (default : <em>false</em>)<br>
</li>
<li>
<strong>useAutoScaling</strong> : Use auto scaling groups to detect instances to deploy to. Cannot be used icw <em>useOpsWorks</em>. (default : <em>false</em>)<br>
</li>
<li>
<strong>elb</strong> : When true the deploy module with wait for instances to come InService on attached elb's before continuing deploy. (default : <em>false</em>)<br>
</li>
</ul>

<h4>
<a id="aws-autoscaling-configuration-options" class="anchor" href="#aws-autoscaling-configuration-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Aws AutoScaling Configuration Options</h4>

<ul>
<li>
<strong>autoScalingGroupId</strong> : The auto scaling group to get the list of instances from. </li>
<li>
<strong>ignoreInStandby</strong> : When true, any instance that is in standby in the auto scaling group will also be added as host to deploy to. InStandby instances will always be deployed to first. (default : <em>false</em>)</li>
<li>
<strong>decrementDesiredCapacity</strong> Decrement configured desired capacity with 1 to make sure that configured policies won't launch a new instance (default : <em>true</em>)</li>
<li>
<strong>maxCapacity</strong> : If Strategy is KEEP_CAPACITY, the capacity of the group wil never grow greater than <strong>maxCapacity</strong>. Defaults to max capacity in configured in auto scaling group.</li>
<li>
<strong>minCapacity</strong> : If Strategy is GUARANTEE_MINIMUM and a deploy failed the build wil also fail if the capacity drops under the configured minimum. (default : <em>1</em>)</li>
<li>
<strong>deployStrategy</strong> : The deploy strategy to use. Valid values are <em>KEEP_CAPACITY</em>, <em>GUARANTEE_MINIMUM</em>, <em>WHATEVER</em>. (default: *KEEP_CAPACITY) </li>
</ul>

<h4>
<a id="auto-scaling-deploy-strategies" class="anchor" href="#auto-scaling-deploy-strategies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Auto Scaling deploy strategies.</h4>

<ul>
<li>
<strong>KEEP_CAPACITY</strong> : The deploy mod wil make sure the auto scale capacity wil not drop during the deploy. Before a deploy an extra instances will be added to the auto scaling group if the desired count is smaller than the auto scaling group
configured maximum. If <em>maxCapacity</em>* is configured the desired count wil never be greater than <strong>maxCapacity</strong>. If <em>elb</em>* is true the current InService count wil be based on the number of instances InService on the elb(s), otherwise the healthy instance count in the elb is used. </li>
<li>
<strong>GUARANTEE_MINIMUM</strong> : Yhe deploy mod does not care if a single instance deploy fails. As long as the InService count never drops below <strong>minCapacity</strong>. With <strong>elb</strong> the InService count on the elb wil be used. Otherwise the auto scaling group healthy count.</li>
<li>
<strong>WHATEVER</strong> : Kittens may die (a.k.a. you don't care, so we don't either, the application may go offline.)</li>
</ul>

<p>Note : When there are no InService instances (elb or auto scaling group) on start of the deploy the strategy wil set to <strong>WHATEVER</strong></p>

<h4>
<a id="aws-opsworks-configuration-options" class="anchor" href="#aws-opsworks-configuration-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Aws OpsWorks Configuration Options</h4>

<ul>
<li>
<strong>String opsWorksLayerId</strong> : The layer id to get a list of instances from.</li>
</ul>

<h3>
<a id="mojos" class="anchor" href="#mojos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mojos</h3>

<p>General Mojo parameters</p>

<ul>
<li>
<strong>deploy.activeTarget</strong> : selects the target configuration</li>
<li>
<strong>deploy.requestTimeout</strong> : overwrites the default timeout (in minutes)</li>
</ul>

<h4>
<a id="mvn-deploydeploy" class="anchor" href="#mvn-deploydeploy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>mvn deploy:deploy</h4>

<p>The default mojo. Based on configuration it wil deploy to a set of configured instances, instances in an OpWorks layer or instances in an auto scaling group.
When deploying to an OpsWorks based set of instances the deploy module can be configured to wait for every instance to come InService on an elb before continuing.</p>

<p>During deploys to an auto scaling group the plugin wil first try to deploy Standby instances and put those back into service. This can be overridden with <strong>ignoreInStandby</strong></p>

<p>When an instance is put InStandby for deployment it wil decrement the desired capacity of the auto scaling group with 1. This can be overridden (  <strong>decrementDesiredCapacity</strong> ). Note that an
auto scaling group will always try to conform to the configured desired amount i.e. it wil launch a new instance.</p>

<p>Note : During a deploy to an auto scaling group the deploy mod temporarily suspends the following auto scaling policies : <em>ScheduledActions</em> , <em>Terminate</em> and <em>ReplaceUnhealthy</em>. These processes are resumed
after the deploy finished (or fails). If the maven task is killed during the deploy those processes are not automatically. This can be fixed either by running a new deploy or with the AWS CLI  </p>

<p>Note : The plugin assumes that a deploy is ready when an instance reaches the status <em>InService</em> on all elb's or when no elb's are attached in the auto scaling group. The default ELB health check
does not guarantee any application to be ready and listening. A custom elb health-check needs to be <a href="http://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-healthchecks.html">configured</a>. </p>

<p>Maven options :</p>

<h4>
<a id="mvn-deploydeploy-direct" class="anchor" href="#mvn-deploydeploy-direct" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>mvn deploy:deploy-direct</h4>

<p>Deploys to a single instance. For example when an instance comes online tools like puppet can instruct a remote Jenkins instance to schedule a build to deploy a set of modules to the newly created instance. 
This mojo ignores <strong>deploy.activeTarget</strong> </p>

<ul>
<li>
<strong>deploy.remoteIp</strong> : The Ip to deploy to <em>required</em> .</li>
<li>
<strong>deploy.testScope</strong> : Include test artifacts  (default : <em>false</em>)</li>
<li>
<strong>deploy.withConfig</strong> : Include config artifacts (default : <em>true</em>)</li>
</ul>

<h4>
<a id="mvn-deploydeploy-single" class="anchor" href="#mvn-deploydeploy-single" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>mvn deploy:deploy-single</h4>

<p>Deploys a single artifact to a DeployTarget </p>

<ul>
<li>
<strong>deploy.single.type</strong> : artifact type <em>required</em>
</li>
<li>
<strong>deploy.single.groupId</strong> : The artifact groupId <em>required</em>
</li>
<li>
<strong>deploy.single.artifactId</strong> : The artifactId <em>required</em>
</li>
<li>
<strong>deploy.single.classifier</strong> : The artifact classifier </li>
<li>
<strong>deploy.single.version</strong> : The artifact version <em>required</em>
</li>
</ul>

<h2>
<a id="vertx-module-configuration" class="anchor" href="#vertx-module-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Vert.X Module Configuration</h2>

<h1>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h1>

<h2>
<a id="deploy-to-multiple-instances-in-an-auto-scaling-group-with-elb-support" class="anchor" href="#deploy-to-multiple-instances-in-an-auto-scaling-group-with-elb-support" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deploy to multiple instances in an auto-scaling group with ELB support.</h2>

<p>The following target configuration wil deploy to all instances in the as-group <em>autoscaling-group-id</em> and check if each instance reached the inService status
on the ELB's it is a member of. If the instance does not reach the inService status within 5 minutes the build wil fail and the remaining instances wil nog be updated</p>

<pre><code>&lt;deployConfiguration&gt;
    &lt;target&gt;[target]&lt;/target&gt;
    &lt;testScope&gt;false&lt;/testScope&gt;
    &lt;restart&gt;true&lt;/restart&gt;
    &lt;elb&gt;true&lt;/elb&gt;
    &lt;autoScaling&gt;true&lt;/autoScaling&gt;
    &lt;autoScalingGroupId&gt;autoscaling-group-id&lt;/autoScalingGroupId&gt;
&lt;/deployConfiguration&gt;
</code></pre>

<h1>
<a id="changelog" class="anchor" href="#changelog" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Changelog</h1>

<h2>
<a id="12-snapshot" class="anchor" href="#12-snapshot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.2-SNAPSHOT</h2>

<ul>
<li>[Feature] Add support for seamless deploy without capacity loss to autoscaling groups with option <code>keepCurrentCapacity</code> defaults to true</li>
<li>[Feature] Add local run support <code>deploy.internal</code>.</li>
<li>[Feature] Add support to deploy to autoscaling groups</li>
<li>[Feature] Add 'aws.as.register.maxduration' and 'aws.as.deregister.maxduration' to overwrite the default timeouts for (de)registration of an instance (autoscaling only). Timeouts are specified in minutes.</li>
<li>[Feature] Make aws region configurable <code>aws.region</code> (defaults to eu-west-1) </li>
<li>[Feature] Default to include instances that are in STANDBY. Instances can be excluded by setting <code>includeInStandby</code> to false in DeployConfiguration.</li>
<li><p>[Feature] Add configuration option <code>aws.as.deregister.decrementDesiredCapacity</code> to configure if desired capacity should be decremented if an instance is put in standby (defaults to true)</p></li>
<li><p>[Maven Plugin] Dropped custom Aws implementation in favor of Amazon SDK</p></li>
<li>[Maven Plugin] Make port configurable, defaults to 6789</li>
<li><p>[Maven Plugin] Make aws region configurable, defaults to eu-west-1</p></li>
<li><p>[Vertx Module] Dropped custom Aws implementation in favor of Amazon SDK</p></li>
<li>[Vertx Module] Make port configurable <code>http.port</code> , defaults to 6789</li>
<li>[Vertx Module] Make aws region configurable, defaults to eu-west-1</li>
</ul>

<p>Note 
Source level changed to 1.8</p>

<h2>
<a id="1115" class="anchor" href="#1115" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.15</h2>

<ul>
<li>[Minor] Add -mod to module zip.</li>
</ul>

<h2>
<a id="1114" class="anchor" href="#1114" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.14</h2>

<ul>
<li>[Bug] Do not list elb's in an autoscaling group as a single string.</li>
<li>[Bug] Ignore null values during xpath parsing for elb instance members.</li>
</ul>

<h2>
<a id="1112" class="anchor" href="#1112" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.1.12</h2>

<ul>
<li>Add configurable request timeout to maven execution ('-Ddeploy.requestTimeout'), defaults to 10 minutes</li>
</ul>
        </section>

        <footer>
          Vertx-deploy-tools is maintained by <a href="https://github.com/msoute">msoute</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
